<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark light" />

    
  <title>Understanding AWS IoT Core Device Shadow: Reported, Desired, and Delta States - Limeleaf Worker Collective</title>
  <meta property="og:title" content="Understanding AWS IoT Core Device Shadow: Reported, Desired, and Delta States ‚Äî Limeleaf Worker Collective" />
  <meta name="twitter:card" content="summary_large_image">
  <meta property="twitter:domain" content="limeleaf.coop">
  <meta property="twitter:url" content="https://limeleaf.coop">
  <meta name="twitter:title" content="Understanding AWS IoT Core Device Shadow: Reported, Desired, and Delta States ‚Äî Limeleaf Worker Collective">
  <meta name="twitter:image" content="/images/logo/limeleaf-logo.jpg">
  <meta property="og:url" content="https://limeleaf.coop" />
  <meta property="og:image" content="/images/logo/limeleaf-logo.jpg" />
  <meta property=‚Äùog:type‚Äù content=‚Äùwebsite‚Äù />
  


    <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml" />
    <link rel="icon" type="image/png" href="https://limeleaf.coop/images/favicon.svg" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flexboxgrid/6.3.1/flexboxgrid.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css" integrity="sha256-XoaMnoYC5TH6/+ihMEnospgm0J1PM/nioxbOUdnM8HY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="https://limeleaf.coop/css/style.css" />
    <script data-goatcounter="https://limeleaf.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    <!-- Calendly badge widget begin -->
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet">
    <script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
    <script type="text/javascript">window.onload = function() { Calendly.initBadgeWidget({ url: 'https://calendly.com/limeleaf/30min', text: 'üóìÔ∏è Schedule a free project assessment', color: '#1C7258', textColor: '#ffffff', branding: undefined }); }</script>
    <!-- Calendly badge widget end -->
  </head>
  <body>
    <div id="full-footer">
    <header class="home">
      <div class="container">
        <section class="row">
          <div id="logo" class="col-sm-4 col-xs-10">
            <a href="https://limeleaf.coop/" title="Limeleaf logo"><img src="https://limeleaf.coop/images/logo/limeleaf-logo-L.svg" alt="Limeleaf logo"/></a>
          </div>
          <nav class="col-sm-8">
            <a href="https://limeleaf.coop/services/" class="link" title="Services">Services</a>
            <a href="https://limeleaf.coop/products/" class="link" title="Products">Products</a>
            <a href="https://limeleaf.coop/blog/" class="link" title="Blog">Blog</a>
            <a href="https://limeleaf.coop/podcast/" class="link" title="Podcast">Podcast</a>
            <a href="https://limeleaf.coop/about/" class="link" title="About Limeleaf">About</a>
            <a href="https://limeleaf.coop/contact/" class="link" title="Contact Us">Contact</a>
          </nav>
        </section>
      </div>
    </header>

    
<main class="container">
  <section class="row">
    <div class="col-xs">
      <article>
      <h1>Understanding AWS IoT Core Device Shadow: Reported, Desired, and Delta States</h1>
      <p><i></i></p>
      <hr class="header" />
      
            
            <p class="small"><i>
              Posted on <time>May 29, 2025</time> 
              
                in
                
                  <a href="https://limeleaf.coop/tags/engineering/">Engineering</a>, 
                  
                
                  <a href="https://limeleaf.coop/tags/iot/">IoT</a>
                
              
              
                by
                    <a href="/members/blain-smith">Blain Smith</a>
                
              </i></p>
            
            <div class="row">
                
                    <div class="col-xs">
                
                <p><p>I've been doing some work for a client that uses Amazon Web Services (AWS) to manage their IoT devices. Specifically, they use <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-device-shadows.html">AWS IoT Core Device Shadow</a> to synchronize state between their devices and their cloud applications. In this post, I thought it would be helpful to explain how the device shadow works, focusing on the <code>reported</code>, <code>desired</code>, and <code>delta</code> states‚Äîand when devices should report their state or respond to changes. Let's dive in!</p>
<span id="continue-reading"></span><h2 id="device-shadow-document-structure">Device Shadow Document Structure</h2>
<p>The shadow document is a JSON structure that contains three primary sections:</p>
<ul>
<li><strong><code>desired</code></strong>: What the cloud application wants the device‚Äôs state to be.</li>
<li><strong><code>reported</code></strong>: What the device reports its current state to be.</li>
<li><strong><code>delta</code></strong>: What‚Äôs different between <code>desired</code> and <code>reported</code>.</li>
</ul>
<p>Here's a typical shadow document:</p>
<pre data-lang="json" style="background-color:#191919;color:#ffffff;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#cccccc;">{
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;state&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;desired&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0xfff&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">13
</span><span style="color:#cccccc;">    },
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;reported&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0x0f0&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">21
</span><span style="color:#cccccc;">    },
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;delta&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0xfff&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">13
</span><span style="color:#cccccc;">    }
</span><span style="color:#cccccc;">  },
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;metadata&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">    </span><span style="background-color:#670000;font-weight:bold;color:#cccccc;">...</span><span style="color:#cccccc;">
</span><span style="color:#cccccc;">  },
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;version&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">13</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;timestamp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">1629999999
</span><span style="color:#cccccc;">}
</span></code></pre>
<h2 id="what-happens-when-the-device-connects">What Happens When the Device Connects</h2>
<p>When a device connects to AWS IoT Core, <strong>it should publish its current state</strong> to the <code>reported</code> section of the device shadow. This is essential because:</p>
<ul>
<li>It tells the cloud what the device is currently doing.</li>
<li>It resets any outdated <code>delta</code> differences.</li>
<li>It prevents redundant commands if the device is already in the desired state.</li>
</ul>
<h3 id="reporting-state-on-first-connect">Reporting State on First Connect</h3>
<pre data-lang="json" style="background-color:#191919;color:#ffffff;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#cccccc;">{
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;state&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;reported&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0x0f0&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">21
</span><span style="color:#cccccc;">    }
</span><span style="color:#cccccc;">  }
</span><span style="color:#cccccc;">}
</span></code></pre>
<p>The device publishes this JSON to the shadow update topic <code>$aws/things/device123/shadow/update</code>. After this, AWS IoT Core compares the new <code>reported</code> state with the existing <code>desired</code> state and computes the <code>delta</code>. A <code>delta</code> message is generated <strong>only when</strong> there is a difference between <code>desired</code> and <code>reported</code> states.</p>
<h3 id="setting-a-new-desired-state">Setting a New Desired State</h3>
<p>Imagine you have a cloud application that must set a remote IoT device's light color to be white and its temperature to be 13. The application publishes this JSON to a specific <a href="https://docs.aws.amazon.com/iot/latest/developerguide/mqtt.html">MQTT topic</a> for the device (e.g., <code>$aws/things/device123/shadow/update/delta</code>):</p>
<pre data-lang="json" style="background-color:#191919;color:#ffffff;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#cccccc;">{
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;state&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;desired&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0xfff&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">13
</span><span style="color:#cccccc;">    }
</span><span style="color:#cccccc;">  }
</span><span style="color:#cccccc;">}
</span></code></pre>
<p>If the device has previously reported:</p>
<pre data-lang="json" style="background-color:#191919;color:#ffffff;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#cccccc;">{
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;state&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;reported&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0x0f0&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">21
</span><span style="color:#cccccc;">    }
</span><span style="color:#cccccc;">  }
</span><span style="color:#cccccc;">}
</span></code></pre>
<p>Then the <code>delta</code> will be:</p>
<pre data-lang="json" style="background-color:#191919;color:#ffffff;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#cccccc;">{
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;state&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0xfff&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">13
</span><span style="color:#cccccc;">  }
</span><span style="color:#cccccc;">}
</span></code></pre>
<p>The device listens for this topic to know what has changed and should take action accordingly.</p>
<h2 id="synchronizing-state">Synchronizing State</h2>
<p>Once the device processes the <code>delta</code>‚Äîfor example, it changes the temperature to 13 and it changes the light color to white‚Äîit must update its <code>reported</code> state again:</p>
<pre data-lang="json" style="background-color:#191919;color:#ffffff;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#cccccc;">{
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;state&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;reported&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0xfff&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">13
</span><span style="color:#cccccc;">    }
</span><span style="color:#cccccc;">  }
</span><span style="color:#cccccc;">}
</span></code></pre>
<p>When <code>reported</code> matches <code>desired</code>, the <code>delta</code> disappears:</p>
<pre data-lang="json" style="background-color:#191919;color:#ffffff;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#cccccc;">{
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;state&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;desired&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0xfff&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">13
</span><span style="color:#cccccc;">    },
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;reported&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0xfff&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">      </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">13
</span><span style="color:#cccccc;">    }
</span><span style="color:#cccccc;">  }
</span><span style="color:#cccccc;">}
</span></code></pre>
<p>No further <code>delta</code> messages are sent unless the desired state changes again.</p>
<h2 id="sequence-diagram-of-state-flow">Sequence Diagram of State Flow</h2>
<pre style="background-color:#191919;color:#ffffff;"><code><span>+-------------------+          +---------------------+         +---------------------+
</span><span>|    Cloud App      |          |   AWS IoT Core      |         |     IoT Device      |
</span><span>+-------------------+          +---------------------+         +---------------------+
</span><span>         |                               |                              | &lt;-- Subscribed to delta
</span><span>         |                               |                              |
</span><span>         | -- Set desired state -------&gt; |                              |
</span><span>         |   { &quot;state&quot;: {                |                              |
</span><span>         |       &quot;desired&quot;: { ... } } }  |                              |
</span><span>         |                               |                              |
</span><span>         |                               | -- Delta calculated ------&gt;  |
</span><span>         |                               |   { &quot;state&quot;: { delta... } }  |
</span><span>         |                               |                              | -- Takes action to apply changes-+
</span><span>         |                               |                              | &lt;--------------------------------+
</span><span>         |                               |                              |
</span><span>         |                               |                              |
</span><span>         |                               |                              |
</span><span>         |                               | &lt;-- Reports new state ------ |
</span><span>         |                               |  { &quot;state&quot;: { reported... } }|
</span><span>         |                               |                              |
</span><span>         |                               | &lt;-- Delta cleared if matched |
</span><span>         |                               |                              |
</span><span>         |                               |                              |
</span></code></pre>
<p><em><strong>Legend of Diagram Actors:</strong></em></p>
<ul>
<li><strong>Cloud App</strong>: Publishes <code>desired</code> state changes to the device shadow on <code>$aws/things/device123/shadow/update</code>.</li>
<li><strong>AWS IoT Core</strong>:
<ul>
<li>Stores <code>desired</code> and <code>reported</code>.</li>
<li>Computes <code>delta</code> when they differ.</li>
<li>Sends <code>delta</code> messages to the device on <code>$aws/things/device123/shadow/update/delta</code>.</li>
</ul>
</li>
<li><strong>IoT Device</strong>:
<ul>
<li>Subscribes to <code>delta</code> topic <code>$aws/things/device123/shadow/update/delta</code>.</li>
<li>Acts on <code>delta</code> message.</li>
<li>Publishes new <code>reported</code> state after making changes on <code>$aws/things/device123/shadow/update</code>.</li>
</ul>
</li>
</ul>
<h3 id="example-data-flow">Example Data Flow</h3>
<ol>
<li>
<p>Cloud App sets:</p>
<pre data-lang="json" style="background-color:#191919;color:#ffffff;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#cccccc;">{
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;state&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;desired&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">     </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0xfff&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">     </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">13
</span><span style="color:#cccccc;">    }
</span><span style="color:#cccccc;">  }
</span><span style="color:#cccccc;">}
</span></code></pre>
</li>
<li>
<p>Delta message sent to device:</p>
<pre data-lang="json" style="background-color:#191919;color:#ffffff;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#cccccc;">{
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;state&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">     </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0xfff&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">     </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">13
</span><span style="color:#cccccc;">  }
</span><span style="color:#cccccc;">}
</span></code></pre>
</li>
<li>
<p>Device updates:</p>
<pre data-lang="json" style="background-color:#191919;color:#ffffff;" class="language-json "><code class="language-json" data-lang="json"><span style="color:#cccccc;">{
</span><span style="color:#cccccc;">  </span><span style="color:#ffd700;">&quot;state&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">    </span><span style="color:#ffd700;">&quot;reported&quot;</span><span style="color:#cccccc;">: {
</span><span style="color:#cccccc;">       </span><span style="color:#ffd700;">&quot;light_color&quot;</span><span style="color:#cccccc;">: </span><span style="color:#ffd700;">&quot;0xfff&quot;</span><span style="color:#cccccc;">,
</span><span style="color:#cccccc;">       </span><span style="color:#ffd700;">&quot;temp&quot;</span><span style="color:#cccccc;">: </span><span style="color:#eddd5a;">13
</span><span style="color:#cccccc;">    }
</span><span style="color:#cccccc;">  }
</span><span style="color:#cccccc;">}
</span></code></pre>
</li>
</ol>
<p>Once <code>reported</code> <strong>equals</strong> <code>desired</code>, the <code>delta</code> is removed, and the shadow reflects synchronization.</p>
<h2 id="best-practices">Best Practices</h2>
<ol>
<li><strong>Report State on Connect</strong>: Devices should always publish their current state upon (re)connection to AWS IoT Core.</li>
<li><strong>Listen to Delta Messages</strong>: Devices should subscribe to the delta topic and act on any changes.</li>
<li><strong>Acknowledge Changes</strong>: After acting on a delta, devices should update their <code>reported</code> state to confirm the change.</li>
<li><strong>Avoid Spamming Desired</strong>: Cloud applications should update <code>desired</code> only when a change is needed‚Äînot continuously‚Äîto prevent unnecessary delta messages.</li>
</ol>
</p>
                </div>
              </div>

      </article>
    </div>
</main>



    <footer>
      <div class="container">
          <div class="col-lg-9">
            <p>We would love to chat about your project and how we can help!</p>
            <p>
              <a href="https://limeleaf.coop/contact/">Contact us</a> or find us on
              <a href="https://bsky.app/profile/limeleaf.coop" alt="Bluesky" title="Bluesky">Bluesky</a>,
              <a href="https://codeberg.org/limeleaf" alt="Gitea" title="Codeberg">Codeberg</a>,
              <a href="https://social.coop/@limeleaf" alt="Mastodon" title="Mastodon">Mastodon</a>,
              <a href="https://opencollective.com/limeleaf" alt="Open Collective" title="Open Collective">Open Collective</a>, 
              <a href="https://www.linkedin.com/company/limeleaf-llc" alt="LinkedIn" title="LinkedIn">LinkedIn</a>, and
              <a href="https://github.com/limeleaf-collective" alt="GitHub" title="GitHub">GitHub</a>.
            </p>
            <p>Copyright 2025 by Limeleaf Worker Collective, LLC</p>
          </div>
      </div>
    </footer>
  </div>
  </body>
</html>
